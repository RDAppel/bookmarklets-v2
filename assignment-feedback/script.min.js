(async()=>{const e=()=>document.querySelector("#panelbutton2 > div > div.user-navigator > div.students-pager > h3 > span:nth-child(3)")?.innerText.split(" (Attempt")[0],t=async(e=0)=>new Promise(((n,o)=>{const c=document.querySelector("#feedbacktext_ifr");if(c)n(c.contentWindow.document.querySelector("#tinymce"));else{if(e>10)return void o("Could not find feedback iframe");setTimeout((()=>n(t(e+1))),250)}}));if(window.heldKeys=window.heldKeys||{},document.addEventListener("keydown",(e=>window.heldKeys[e.code]=!0)),document.addEventListener("keyup",(e=>delete window.heldKeys[e.code])),window.heldKeys.KeyE){window.heldKeys={};const e=Object.entries({...localStorage}).filter((([e])=>e.startsWith("feedback-")));return void((e,t,n="text/plain")=>{const o=document.createElement("a"),c=new Blob([e],{type:n});o.href=URL.createObjectURL(c),o.download=t,o.click()})(JSON.stringify(e,null,2),"feedback.json","application/json")}let n=null,o=!1;if(window.heldKeys.KeyI){o=!0,window.heldKeys={};const e=document.createElement("div");e.classList.add("drop");const t=document.createElement("p");t.textContent="Drop feedback.json here.",e.append(t),document.body.append(e);const c=async t=>{t.preventDefault(),t.bubbles=!1;const c=t.dataTransfer.files[0],a=await c.text(),d=JSON.parse(a);e.remove(),!1!==confirm("Are you sure you want to overwrite your feedback?")&&(d.forEach((([e,t])=>localStorage.setItem(e,t))),n&&n(),o=!1)};e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",c),e.addEventListener("click",(()=>e.remove()))}const c="\n#feedback-panel{font-family:Arial,sans-serif;background-color:white;position:fixed;left:0;right:412px;bottom:0;height:30%;border:1px solid darkgray;padding:12px 48px;z-index:10001;}\n#feedback-panel a{underline;cursor:pointer;}\n#feedback-panel a:hover{text-decoration:underline;}\n#feedback-panel-container{display:flex;flex-direction:row;justify-content:space-between;align-content:stretch;gap:12px;width:100%;height:calc(100% - 24px);border:0;}\n.feedback-panel-inner {background-color:#eee;padding:12px;flex-grow:1;min-width:25%;height:100%}\n.feedback-panel-inner .items {min-height:75%;overflow-y:scroll;margin-bottom:6px;}\n.feedback-panel-inner p {margin:2px;}\n.feedback-panel-inner p a {margin-right:1em;}\n.feedback-panel-inner .title {font-weight:bold;border-bottom:1px solid black;padding-bottom:2px;margin-bottom:4;text-align:center;}\n.feedback-panel-inner button {margin-top:2px;margin-right:2px;}\n.drop {position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;font-size:2em;z-index:10002;}\n.drop p {background-color:white;padding:24px;border:1px solid black;}\n",a=document.querySelector("#crumb_1")?.textContent.trim().split(" ").slice(0,-1).join(" "),d=document.querySelector("#pageTitleText")?.textContent;if(!a||!d)return console.error("Could not find course or assignment id");const r=document.createElement("style");r.styleSheet?r.styleSheet.cssText=c:r.appendChild(document.createTextNode(c)),document.querySelector("head").appendChild(r);const i="feedback-panel",l=document.querySelector("#feedback-panel");if(l&&!o){const{display:e}=window.getComputedStyle(l);return void(l.style.display="none"===e?"block":"none")}const s="right-to-left",p=localStorage.getItem(s)||"false";localStorage.setItem(s,p);const m={general:"feedback-general",course:`feedback-course(${a})`,assignment:`feedback-assignment(${a}/${d})`},u=document.querySelector("#currentAttempt_gradeDataPanelLink");"true"!==u.getAttribute("aria-expanded")&&u.click();const g=e=>JSON.parse(localStorage.getItem(m[e]))||[],f=(e,t)=>localStorage.setItem(m[e],JSON.stringify(t)),h=e=>`${e[0].toUpperCase()}${e.slice(1)}`,b=l||document.createElement("div");b.innerHTML="",b.id=i,b.classList.add("feedback-panel"),document.body.appendChild(b);const w=document.createElement("div");w.id="feedback-panel-container",b.appendChild(w);const y=await t(),x=(t,n,o)=>{const c=(e=>(JSON.parse(localStorage.getItem("aliases"))||{})[e]||e.split(" ")[0])(e()),a=t.trim().replace("{{name}}",c),d="{{check}}",r=()=>{(e=>{const t=document.createRange();t.selectNodeContents(e),t.collapse(!1);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)})(y),y.focus();const e=document.createElement("p");e.textContent=l.textContent,y.append(e);const t=y.querySelector("p");""===t.textContent.trim()&&t.remove()},i=document.createElement("p");n.append(i);const l=document.createElement("a");if(l.innerText=a.replace(d,""),i.append(l),l.addEventListener("click",(t=>{if(t.altKey){const t=window.prompt("Enter alias for student",c);t&&(((e,t)=>{const n=JSON.parse(localStorage.getItem("aliases"))||{};n[e]=t,localStorage.setItem("aliases",JSON.stringify(n))})(e(),t),k())}else r()})),t.substring(t.length-d.length)===d){const e=document.createElement("a");e.title="Add feedback and submit with full points.",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="16" height="16" viewBox="0 0 24 24"><path d="M 20.292969 5.2929688 L 9 16.585938 L 4.7070312 12.292969 L 3.2929688 13.707031 L 9 19.414062 L 21.707031 6.7070312 L 20.292969 5.2929688 z"></path></svg>',i.append(e),e.addEventListener("click",(()=>{document.querySelector("#currentAttempt_grade").value=document.querySelector("#currentAttempt_pointsPossible").textContent.slice(1),r(),setTimeout((()=>document.querySelector("#currentAttempt_submitButton").dispatchEvent(new Event("click"))),100)}))}const s=document.createElement("a");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000" version="1.1" id="Capa_1" width="16" height="16" viewBox="0 0 482.428 482.429" xml:space="preserve"><g><g><path d="M381.163,57.799h-75.094C302.323,25.316,274.686,0,241.214,0c-33.471,0-61.104,25.315-64.85,57.799h-75.098    c-30.39,0-55.111,24.728-55.111,55.117v2.828c0,23.223,14.46,43.1,34.83,51.199v260.369c0,30.39,24.724,55.117,55.112,55.117    h210.236c30.389,0,55.111-24.729,55.111-55.117V166.944c20.369-8.1,34.83-27.977,34.83-51.199v-2.828    C436.274,82.527,411.551,57.799,381.163,57.799z M241.214,26.139c19.037,0,34.927,13.645,38.443,31.66h-76.879    C206.293,39.783,222.184,26.139,241.214,26.139z M375.305,427.312c0,15.978-13,28.979-28.973,28.979H136.096    c-15.973,0-28.973-13.002-28.973-28.979V170.861h268.182V427.312z M410.135,115.744c0,15.978-13,28.979-28.973,28.979H101.266    c-15.973,0-28.973-13.001-28.973-28.979v-2.828c0-15.978,13-28.979,28.973-28.979h279.897c15.973,0,28.973,13.001,28.973,28.979    V115.744z"/><path d="M171.144,422.863c7.218,0,13.069-5.853,13.069-13.068V262.641c0-7.216-5.852-13.07-13.069-13.07    c-7.217,0-13.069,5.854-13.069,13.07v147.154C158.074,417.012,163.926,422.863,171.144,422.863z"/><path d="M241.214,422.863c7.218,0,13.07-5.853,13.07-13.068V262.641c0-7.216-5.854-13.07-13.07-13.07    c-7.217,0-13.069,5.854-13.069,13.07v147.154C228.145,417.012,233.996,422.863,241.214,422.863z"/><path d="M311.284,422.863c7.217,0,13.068-5.853,13.068-13.068V262.641c0-7.216-5.852-13.07-13.068-13.07    c-7.219,0-13.07,5.854-13.07,13.07v147.154C298.213,417.012,304.067,422.863,311.284,422.863z"/></g></g></svg>',i.append(s),s.addEventListener("click",(()=>{if(confirm("Are you sure you want to delete this feedback?")){i.remove();const e=g(o),n=e.indexOf(t);if(n<0)return;f(o,[...e.slice(0,n),...e.slice(n+1)])}}))},k=()=>{w.innerHTML="";const e=Object.keys(m);("true"===p?e.reverse():e).forEach((e=>{const t=document.createElement("div");t.classList.add("feedback-panel-inner"),w.append(t);const n=document.createElement("div");n.textContent=`${h(e)} Feedback`,n.classList.add("title"),t.append(n);const o=document.createElement("div");o.classList.add("items"),t.append(o);g(e).forEach((t=>x(t,o,e)));const c=document.createElement("button");c.textContent=`New ${h(e)} Feedback`,t.append(c),c.addEventListener("click",(()=>{const t=window.prompt("Enter feedback text. Use {{name}} to insert student's first name. Optionally you can add {{check}} to the end and this will add the ability to auto submit with full credit.","Great job, {{name}}! {{check}}");t&&(x(t,o),f(e,[...g(e),t]))}))}))};k(),n=k})();